(function(n,I){typeof exports=="object"&&typeof module<"u"?module.exports=I(require("react")):typeof define=="function"&&define.amd?define(["react"],I):(n=typeof globalThis<"u"?globalThis:n||self,n.MyReactLibrary=I(n.React))})(this,function(n){"use strict";const I=e=>{const[t,s]=n.useState(0),[a,c]=n.useState(!1),i=n.useRef(null),r=n.useCallback(()=>{i.current&&s(i.current.height)},[]);return n.useEffect(()=>{const l=()=>{c(!0),r()},d=i.current;return d&&(d.complete?l():d.addEventListener("load",l)),window.addEventListener("resize",r),()=>{d&&d.removeEventListener("load",l),window.removeEventListener("resize",r)}},[e,r]),[i,t,a]},k=(e={})=>{const[t,s]=n.useState(!1),a=n.useRef(null);return n.useEffect(()=>{const c=new IntersectionObserver(r=>{const[l]=r;l&&(l.isIntersecting?s(!0):s(!1))},{...e}),{current:i}=a;return i&&c.observe(i),()=>{i&&c.unobserve(i)}},[e]),[a,t]};class x{constructor(){this.callbacks=new Set,this.animationFrameId=null}static getInstance(){return x.instance||(x.instance=new x),x.instance}register(t){this.callbacks.add(t),this.animationFrameId===null&&this.start()}unregister(t){this.callbacks.delete(t),this.callbacks.size===0&&this.animationFrameId!==null&&this.stop()}start(){const t=()=>{this.callbacks.forEach(s=>s()),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const M=x.getInstance(),H=(e,t)=>e*t-e,L=(e,t)=>Math.ceil(e/100*t-t/2),P=(e,t)=>{const{top:s,height:a}=e;let c=-a;const i=t;if(s<c)return 0;if(s>i)return 100;const r=(s-c)/(i-c)*100;return Math.round(Math.min(Math.max(r,0),100)*100)/100},v=(e,t)=>{switch(t){case"up":return`0, ${e}px, 0`;case"right":return`${-e}px, 0, 0`;case"down":return`0, ${-e}px, 0`;case"left":return`${e}px, 0, 0`;case"up left":return`${e}px, ${e}px, 0`;case"up right":return`${-e}px, ${e}px, 0`;case"down left":return`${e}px, ${-e}px, 0`;case"down right":return`${-e}px, ${-e}px, 0`;default:return`0, ${e}px, 0`}},C=()=>{const[e,t]=n.useState(null);return n.useEffect(()=>{const s=()=>{t(window.innerHeight)};if(typeof window<"u")return t(window.innerHeight),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),e},z=({isLoaded:e,imageHeight:t,scale:s,boundingClientRect:a,orientation:c,maxTransition:i})=>{const[r,l]=n.useState(""),d=n.useRef({rangeMax:0,lastImageHeight:0,lastScale:0,lastTranslateValue:-999999,lastTransformString:""}),u=C();return n.useEffect(()=>{if(!e||!a||!u)return;const o=d.current;(o.lastImageHeight!==t||o.lastScale!==s)&&(o.rangeMax=H(t,s),o.lastImageHeight=t,o.lastScale=s);let p=P(a,u);i&&(p=Math.min(p,100-i));const m=L(p,o.rangeMax);if(o.lastTranslateValue!==m){const h=v(m,c);h!==o.lastTransformString&&(o.lastTranslateValue=m,o.lastTransformString=h,l(h))}},[e,t,s,a,c,i,u]),r},A=()=>{const[e,t]=n.useState(!1);return n.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia("(prefers-reduced-motion: reduce)");t(s.matches);const a=c=>{t(c.matches)};return s.addEventListener("change",a),()=>{s.removeEventListener("change",a)}},[]),e},N=({scale:e,overflow:t,delay:s,transition:a,orientation:c,maxTransition:i,isVisible:r,isLoaded:l,imageHeight:d,imageRef:u})=>{const[o,p]=n.useState(!1),[m,h]=n.useState(0),[S,b]=n.useState(null),[E,y]=n.useState(!1),f=A(),$=z({isLoaded:l,imageHeight:d,scale:e,boundingClientRect:S,orientation:c,maxTransition:i}),V=n.useCallback(g=>{if(!u.current||f||!g)return;let w=`translate3d(${g})`;t||(w+=` scale(${e})`),u.current.style.transform=w},[u,e,t,f]),F=n.useCallback(g=>{if(!u.current||f)return;const w=g&&s>0?`transform ${s}s ${a}`:"";u.current.style.transition=w},[u,s,a,f]),T=n.useCallback(()=>{var g;if(!(!r&&o||f)&&(window.scrollY!==m||!o)){const w=(g=u.current)==null?void 0:g.getBoundingClientRect();w&&b(w),o||setTimeout(()=>{y(!0)},50),h(window.scrollY)}},[m,r,u,o,f]);n.useEffect(()=>{$&&(r||!o)&&(V($),p(!0))},[$,r,o,V]),n.useEffect(()=>{!t&&l&&u.current&&!f&&(u.current.style.transform=`scale(${e})`)},[e,t,l,f]),n.useEffect(()=>{F(E)},[E,F]),n.useEffect(()=>(f||M.register(T),()=>{M.unregister(T)}),[T,f]),n.useEffect(()=>{f&&u.current&&(u.current.style.transform="",u.current.style.transition="")},[f])};var j="/Users/geoffrey/Desktop/perso/simpleParallax.js/src/react/index.tsx";return({delay:e=.4,orientation:t="up",scale:s=1.4,overflow:a=!1,transition:c="cubic-bezier(0,0,0,1)",maxTransition:i=null,children:r})=>{var E;const l=t??"up",d=s??1.2,u=(E=r==null?void 0:r.props)==null?void 0:E.src,[o,p,m]=I(u),[h,S]=k({root:null,rootMargin:"0px",threshold:Array.from(Array(101).keys(),y=>y/100)});N({scale:d,overflow:a,delay:e,transition:c,orientation:l,maxTransition:i,isVisible:S,isLoaded:m,imageHeight:p,imageRef:o});const b=n.isValidElement(r)?n.cloneElement(r,{ref:o}):null;return n.createElement("div",{ref:h,style:{overflow:a?"visible":"hidden"},__self:void 0,__source:{fileName:j,lineNumber:47,columnNumber:3}},b)}});
